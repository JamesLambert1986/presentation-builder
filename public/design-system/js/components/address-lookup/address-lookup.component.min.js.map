{"version":3,"file":"address-lookup.component.min.js","sources":["address-lookup.component.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n// @ts-nocheck\nimport Cookies from 'js-cookie';\n// Data layer Web component created\nwindow.dataLayer = window.dataLayer || [];\nwindow.dataLayer.push({\n    \"event\": \"customElementRegistered\",\n    \"element\": \"Address Lookup\"\n});\nclass iamAddressLookup extends HTMLElement {\n    constructor() {\n        super();\n        this.attachShadow({ mode: 'open' });\n        const assetLocation = document.body.hasAttribute('data-assets-location') ? document.body.getAttribute('data-assets-location') : '/assets';\n        const coreCSS = document.body.hasAttribute('data-core-css') ? document.body.getAttribute('data-core-css') : `${assetLocation}/css/core.min.css`;\n        const loadCSS = `@import \"${assetLocation}/css/components/address-lookup.css\";`;\n        const template = document.createElement('template');\n        template.innerHTML = `\r\n    <style>\r\n    @import \"${coreCSS}\";\r\n    ${loadCSS}\r\n    \r\n    ${this.hasAttribute('css') ? `@import \"${this.getAttribute('css')}\";` : ``}\r\n    </style>\r\n    <link rel=\"stylesheet\" href=\"https://kit.fontawesome.com/26fdbf0179.css\" crossorigin=\"anonymous\" />\r\n    <div class=\"wrapper\">\r\n\r\n      <div class=\"postcode-lookup\">\r\n        <div>\r\n        <label class=\"mb-2\">Search <span class=\"title text-lowercase\"></span> <span class=\"optional\">(Optional)</span>\r\n          <span>\r\n          <input type=\"text\" name=\"postcode\" list=\"address-lookup__addressess\" autocomplete=\"off\" aria-autocomplete=\"none\" placeholder=\"Postcode\" />\r\n          <span class=\"suffix fa-regular fa-search\"></span>\r\n          </span>\r\n          <span class=\"invalid-feedback\">Required Adddress fields missing</span>\r\n        </label>\r\n\r\n        </div>\r\n        <button class=\"btn btn-tertiary switch-to-manual-btn\">Or enter address manually</button>\r\n      </div>\r\n      <datalist id=\"address-lookup__addressess\"></datalist>\r\n\r\n      <div class=\"manual-address pb-2 js-hide\">\r\n        <slot></slot>\r\n        <button class=\"btn btn-tertiary switch-to-lookup-btn\">Use postcode lookup</button>\r\n      </div>\r\n      <div class=\"pre-filled pb-2 js-hide\">\r\n        <strong class=\"title text-primary d-block\"></strong>\r\n        <p><span class=\"pre-filled-address\"></span><button class=\"text-primary text-decoration-none ms-1 cursor-pointer\"><i class=\"fa-regular fa-pen-to-square\"></i><span class=\"visually-hidden\">Edit</span></button><slot name=\"prefilled\"></slot></p>\r\n      </div>\r\n    </div>\r\n    `;\n        this.shadowRoot.appendChild(template.content.cloneNode(true));\n    }\n    connectedCallback() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const wrapper = this.shadowRoot.querySelector('.wrapper');\n            const lookup = this.shadowRoot.querySelector('[name=\"postcode\"]');\n            const lookupWrapper = this.shadowRoot.querySelector('.postcode-lookup');\n            const manualWrapper = this.shadowRoot.querySelector('.manual-address');\n            const preFilledWrapper = this.shadowRoot.querySelector('.pre-filled');\n            const list = this.shadowRoot.querySelector('datalist');\n            const switchManualBtn = this.shadowRoot.querySelector('.switch-to-manual-btn');\n            const switchLookupBtn = this.shadowRoot.querySelector('.switch-to-lookup-btn');\n            const title = this.hasAttribute('data-title') ? this.getAttribute('data-title') : \"Property address\";\n            const preFilledAddressBtn = this.shadowRoot.querySelector('.pre-filled-address + button');\n            Array.from(this.shadowRoot.querySelectorAll('.title')).forEach((titleElement, index) => {\n                titleElement.innerHTML = title;\n            });\n            function checkFilled(component) {\n                let preFilledAddress = component.shadowRoot.querySelector('.pre-filled-address');\n                let preFilled = true;\n                preFilledAddress.innerHTML = \"\";\n                Array.from(component.querySelectorAll('input[required],input[data-required],select[required],select[data-required]')).forEach((input, index) => {\n                    const value = input.value;\n                    if (!value)\n                        preFilled = false;\n                    else\n                        preFilledAddress.innerHTML += value + (/^-?\\d+$/.test(value) ? ' ' : ', ');\n                });\n                preFilledAddress.innerHTML = preFilledAddress.innerHTML.slice(0, -2);\n                if (preFilled) {\n                    preFilledWrapper.classList.remove('js-hide');\n                    lookupWrapper.classList.add('js-hide');\n                    manualWrapper.classList.add('js-hide');\n                }\n            }\n            checkFilled(this);\n            this.addEventListener('filled', (event) => {\n                checkFilled(this);\n            });\n            if (this.hasAttribute('data-use')) {\n                let useLabel = this.hasAttribute('data-use-label') ? this.getAttribute('data-use-label') : 'Use saved address';\n                let useCheckbox = `<div><input type=\"checkbox\" name=\"use\" id=\"use\" value=\"yes\"><label for=\"use\">${useLabel}</label></div>`;\n                lookupWrapper.insertAdjacentHTML('afterbegin', useCheckbox);\n                this.shadowRoot.addEventListener('change', (event) => {\n                    if (event && event.target instanceof HTMLElement && event.target.closest('[name=\"use\"]')) {\n                        let checkbox = event.target.closest('[name=\"use\"]');\n                        if (checkbox.checked) {\n                            lookupWrapper.classList.add('js-hide');\n                            manualWrapper.classList.remove('js-hide');\n                            let values = JSON.parse(this.getAttribute('data-use'));\n                            Object.keys(values).forEach((key, index) => {\n                                let value = values[key];\n                                if (this.querySelector(`[data-name=\"${key}\"]`))\n                                    this.querySelector(`[data-name=\"${key}\"]`).value = value;\n                                else if (this.querySelector(`[name=\"${key}\"]`))\n                                    this.querySelector(`[name=\"${key}\"]`).value = value;\n                            });\n                        }\n                    }\n                });\n            }\n            function openManualWrapper() {\n                lookupWrapper.classList.add('js-hide');\n                manualWrapper.classList.remove('js-hide');\n                Array.from(manualWrapper.querySelectorAll('[data-required]')).forEach((input, index) => {\n                    input.setAttribute('required', 'true');\n                });\n                manualWrapper.scrollIntoView();\n            }\n            preFilledAddressBtn.addEventListener('click', (event) => {\n                preFilledWrapper.classList.add('js-hide');\n                openManualWrapper();\n            });\n            switchManualBtn.addEventListener('click', (event) => {\n                openManualWrapper();\n            });\n            switchLookupBtn.addEventListener('click', (event) => {\n                lookupWrapper.classList.remove('js-hide');\n                manualWrapper.classList.add('js-hide');\n                lookupWrapper.scrollIntoView();\n            });\n            lookup.addEventListener('keyup', (event) => {\n                if (lookup.value.length >= 3)\n                    search(lookup.value);\n            });\n            lookup.addEventListener('change', (event) => {\n                if (lookup.value.length >= 3) {\n                    search(lookup.value);\n                    if (list.querySelector(`[value=\"${lookup.value}\"]`)) {\n                        lookupWrapper.classList.add('js-hide');\n                        manualWrapper.classList.remove('js-hide');\n                        let values = JSON.parse(list.querySelector(`[value=\"${lookup.value}\"]`).getAttribute('data-values'));\n                        Object.keys(values).forEach((key, index) => {\n                            let value = values[key];\n                            if (this.querySelector(`[data-name=\"${key}\"]`))\n                                this.querySelector(`[data-name=\"${key}\"]`).value = value;\n                            else if (this.querySelector(`[name=\"${key}\"]`))\n                                this.querySelector(`[name=\"${key}\"]`).value = value;\n                        });\n                        // Focus on first input\n                        this.querySelector('[data-name=\"address_1\"]').focus();\n                        Array.from(this.querySelectorAll('[data-required]')).forEach((input, index) => {\n                            input.setAttribute('required', 'true');\n                        });\n                        lookup.removeAttribute('required');\n                        if (this.shadowRoot.querySelector('[name=\"use\"]'))\n                            this.shadowRoot.querySelector('[name=\"use\"]').checked = false;\n                    }\n                }\n            });\n            const search = (postcode) => __awaiter(this, void 0, void 0, function* () {\n                let ajaxURL = this.getAttribute('data-url');\n                ajaxURL += `${encodeURI(postcode)}`;\n                // Setup controller vars if not already set\n                if (!window.controller)\n                    window.controller = [];\n                // Abort if controller already present for this url\n                if (window.controller[ajaxURL])\n                    window.controller[ajaxURL].abort();\n                // Create a new controller so it can be aborted if new fetch made\n                window.controller[ajaxURL] = new AbortController();\n                const { signal } = controller[ajaxURL];\n                try {\n                    yield fetch(ajaxURL, {\n                        signal: signal,\n                        method: 'get',\n                        credentials: 'same-origin',\n                        headers: new Headers({\n                            'Content-Type': 'application/json',\n                            Accept: 'application/json',\n                            'X-Requested-With': 'XMLHttpRequest',\n                            'X-XSRF-TOKEN': Cookies.get('XSRF-TOKEN')\n                        })\n                    })\n                        .then((response) => response.json()).then((response) => {\n                        // populate datalist\n                        let listString = '';\n                        response.forEach((address, index) => {\n                            // Deal with agent platform response\n                            if (typeof address.value == \"object\") {\n                                let values = JSON.stringify(address.value);\n                                listString += `<option value=\"${address['label']}, ${postcode}\" data-values='${values}'></option>`;\n                            }\n                            else {\n                                let values = JSON.stringify(address);\n                                let itemString = '';\n                                for (const [key, value] of Object.entries(address)) {\n                                    if (key == \"address_number_name\")\n                                        itemString += `${value} `;\n                                    else if (key != \"postcode\" && key != \"address_title\")\n                                        itemString += `${value}${(/^-?\\d+$/.test(value) ? '' : ',')} `;\n                                }\n                                listString += `<option value=\"${itemString}${postcode}\" data-values='${values}'></option>`;\n                            }\n                        });\n                        list.innerHTML = listString;\n                        return response;\n                    });\n                }\n                catch (error) {\n                    console.log(error);\n                }\n            });\n        });\n    }\n}\nexport default iamAddressLookup;\n"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","reject","fulfilled","step","e","rejected","result","iamAddressLookup","assetLocation","coreCSS","template","lookup","lookupWrapper","manualWrapper","preFilledWrapper","list","switchManualBtn","switchLookupBtn","title","preFilledAddressBtn","titleElement","index","checkFilled","component","preFilledAddress","preFilled","input","event","useCheckbox","values","key","openManualWrapper","search","postcode","ajaxURL","signal","Cookies","response","listString","address","itemString","error"],"mappings":"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"}