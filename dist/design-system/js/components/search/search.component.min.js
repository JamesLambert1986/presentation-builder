/*!
  * iamKey v5.5.0
  * Copyright 2022-2024 iamproperty
  */import k from"js-cookie";const q=e=>e.replace(/ /g,"_"),x=function(e){return e=e.toLowerCase(),e=q(e),e=e.replace(/\W/g,""),e},m=(e,s,a)=>s.split(/[\.\[\]\'\"]/).filter(o=>o).reduce((o,d)=>o?o[d]:a,e),S=e=>Array.isArray(e)||e!==null&&["function","object"].includes(typeof e);var L=function(e,s,a,o){function d(c){return c instanceof a?c:new a(function(n){n(c)})}return new(a||(a=Promise))(function(c,n){function v(r){try{u(o.next(r))}catch(i){n(i)}}function t(r){try{u(o.throw(r))}catch(i){n(i)}}function u(r){r.done?c(r.value):d(r.value).then(v,t)}u((o=o.apply(e,s||[])).next())})};window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"customElementRegistered",element:"Search"});class C extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});const s=document.body.hasAttribute("data-assets-location")?document.body.getAttribute("data-assets-location"):"/assets",a=document.body.hasAttribute("data-core-css")?document.body.getAttribute("data-core-css"):`${s}/css/core.min.css`,o=document.createElement("template");o.innerHTML=`
    <style>
    @import "${a}";
    input {
      background: red;
    }
    input:not(.is-invalid):not(:invalid) {
      background: none!important;
    }
    .optional-text {
      display: none;
    }
    </style>
    <link rel="stylesheet" href="https://kit.fontawesome.com/26fdbf0179.css" crossorigin="anonymous" />
    <slot></slot>
    `,this.shadowRoot.appendChild(o.content.cloneNode(!0))}connectedCallback(){return L(this,void 0,void 0,function*(){const s=this,a=this.querySelector("input"),o=this.hasAttribute("data-value-schema")?this.getAttribute("data-value-schema"):"value",d=this.hasAttribute("data-display-schema")?this.getAttribute("data-display-schema"):"label",c=this.hasAttribute("data-schema")?this.getAttribute("data-schema"):"";let n=this.querySelector("datalist"),v=[];const t=a.cloneNode();if(t.setAttribute("name",`${a.getAttribute("name")}Alt`),a.removeAttribute("data-change-events"),t.removeAttribute("id"),a.after(t),a.setAttribute("type","hidden"),!n){n=document.createElement("datalist");let i=x("list");n.setAttribute("id",i),s.appendChild(n),t.setAttribute("list",i)}s.hasAttribute("data-url")&&t.addEventListener("input",i=>{t.value.length==3&&!v.includes(t.value)&&(r(t.value),v.push(t.value))});function u(){let i=n.querySelector(`option[value="${t.value}"]`),l=n.querySelector(`option[value*="${t.value}" i]`);i?a.value=i.getAttribute("data-value"):t.value.length>0&&!l?(t.classList.add("is-invalid"),t.closest("label").setAttribute("data-error","No results returned")):(t.classList.remove("is-invalid"),t.closest("label").removeAttribute("data-error"))}t.addEventListener("input",i=>{u()});const r=i=>L(this,void 0,void 0,function*(){let l=s.getAttribute("data-url");l+=`${encodeURI(i)}`,window.controller||(window.controller=[]),window.controller[l]&&window.controller[l].abort(),window.controller[l]=new AbortController;const{signal:E}=controller[l];try{yield fetch(l,{signal:E,method:"get",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-XSRF-TOKEN":k.get("XSRF-TOKEN")})}).then(h=>h.json()).then(h=>{let w="",p=m(h,c,"");if(S(p)&&typeof p.forEach=="function")p.forEach((b,y)=>{let f=m(b,o,""),A=m(b,d,"").replace(`
`,", ");console.log(A),n.querySelector(`option[data-value="${f}"]`)||(w+=`<option value="${A}" data-value="${f}"></option>`)});else if(typeof p=="object")for(const[b,y]of Object.entries(p))S(y)&&typeof y.forEach=="function"&&y.forEach((f,A)=>{let g=m(f,o,""),$=m(f,d,"").replace(`
`,", ");n.querySelector(`option[data-value="${g}"]`)||(w+=`<option value="${b}: ${$}" data-value='${g}'></option>`)});return n.innerHTML+=w,t.closest("form").classList.add("was-validated"),u(),h})}catch(h){console.log(h)}});s.hasAttribute("data-prevent-submit")&&s.closest("form").addEventListener("submit",l=>{l.preventDefault()})})}}export{C as default};
//# sourceMappingURL=search.component.min.js.map
